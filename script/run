#!/bin/bash
set -e

cd "$(dirname "$0")/.."

if [ -f .env ]; then
    source .env
fi

export JAVA_HOME
export ANDROID_HOME
./gradlew clean assembleDebug

if [ $? -eq 0 ]; then
    echo "Build successful! Installing..."
    adb install -r app/build/outputs/apk/debug/app-debug.apk
    
    echo "Launching app..."
    adb shell am start -n pro.trousev.mealcontrol/.MainActivity
    
    echo "Starting logcat (Ctrl+C to exit)..."
    adb logcat -c
    adb logcat | grep -E "mealcontrol|Activity|ViewModel"
else
    echo "Build failed!"
    exit 1
fi
